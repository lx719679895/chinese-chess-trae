# 实现中国象棋对战模式功能

## 一、需求分析
1. 新增两种对战模式：玩家vs玩家（PvP）和玩家vs电脑（PvE）
2. PvP模式需完全保留现有功能，确保向后兼容
3. PvE模式需实现AI对手，包括难度设置、电脑决策逻辑等
4. 两种模式需有明确的选择入口
5. 模式切换时数据状态需正确重置
6. 各自对战进度需独立保存

## 二、实现方案

### 1. 添加必要的枚举和常量
- 在`Constants.ts`中添加`GameMode`枚举（PVP, PVE）
- 添加`AIDifficulty`枚举（EASY, MEDIUM, HARD）
- 添加AI相关的常量配置

### 2. 修改GameModel类
- 添加`gameMode`属性，用于标识当前对战模式
- 添加`aiDifficulty`属性，用于标识AI难度
- 添加`aiPlayerColor`属性，用于标识AI玩家颜色
- 确保历史记录和存档功能支持不同模式

### 3. 实现AI决策逻辑
- 创建`AI.ts`文件，实现AI决策核心逻辑
- 简单难度：随机选择合法移动
- 中等难度：考虑吃子和将军情况
- 困难难度：考虑多步走法和局势评估
- 实现AI回合自动执行逻辑

### 4. 修改Game类
- 添加`ai`属性，用于AI决策
- 修改`movePiece`方法，支持AI回合自动执行
- 添加`setGameMode`方法，用于切换对战模式
- 添加`setAIDifficulty`方法，用于设置AI难度
- 修改事件处理逻辑，根据当前模式决定是否允许玩家操作

### 5. 更新UI界面
- 添加模式选择区域，支持PvP和PvE模式切换
- 添加AI难度设置选项
- 添加AI玩家颜色选择（可选）
- 确保UI状态与当前游戏模式同步

### 6. 修改存档功能
- 修改`SaveLoad.ts`，确保不同模式的游戏进度独立保存
- 使用不同的存档键名区分不同模式
- 加载时根据当前模式加载对应存档

## 三、关键实现细节

### 1. AI决策流程
- 获取当前回合所有合法移动
- 根据难度等级评估移动优先级
- 选择最优移动并执行
- 支持异步执行，避免游戏卡顿

### 2. 模式切换处理
- 保存当前模式进度
- 重置游戏状态
- 初始化新模式的游戏数据
- 更新UI状态

### 3. 存档机制
- 使用`localStorage`保存游戏进度
- 键名格式：`chess_game_${gameMode}_${aiDifficulty}`
- 支持自动保存和手动保存

## 四、测试要点
1. PvP模式完全保留现有功能
2. PvE模式AI能正常决策和执行移动
3. 不同难度AI表现有明显差异
4. 模式切换时状态正确重置
5. 不同模式的进度独立保存和加载
6. 在不同屏幕尺寸下UI正常显示

## 五、文件修改清单
1. `Constants.ts` - 添加枚举和常量
2. `GameModel.ts` - 添加模式相关属性
3. `AI.ts` - 实现AI决策逻辑
4. `Game.ts` - 添加模式切换和AI回合处理
5. `SaveLoad.ts` - 修改存档机制
6. `index.html` - 添加模式选择UI
7. `main.ts` - 更新初始化逻辑

## 六、技术考虑
- 确保AI决策高效，避免游戏卡顿
- 保持代码结构清晰，遵循现有设计模式
- 确保向后兼容，不破坏现有功能
- 提供良好的用户体验，包括清晰的模式选择和反馈